package dcmd_api;
option java_package = "com.cwinux.dcmd";

enum DcmdMsgType {
   MTYPE_AGENT_REPORT = 1; 
   MTYPE_AGENT_REPORT_R = 2;
   MTYPE_AGENT_HEATBEAT = 3;
   MTYPE_CENTER_MASTER_NOTICE = 5;
   MTYPE_CENTER_MASTER_NOTICE_R = 6;
   MTYPE_CENTER_SUBTASK_CMD = 7;
   MTYPE_CENTER_SUBTASK_CMD_R = 8;
   MTYPE_AGENT_SUBTASK_PROCESS = 9;
   MTYPE_AGENT_SUBTASK_CMD_RESULT = 11;
   MTYPE_AGENT_SUBTASK_CMD_RESULT_R = 12;
   MTYPE_CENTER_OPR_CMD = 13;
   MTYPE_CENTER_OPR_CMD_R = 14;
   MTYPE_CENTER_AGENT_SUBTASK_OUTPUT = 15;
   MTYPE_CENTER_AGENT_SUBTASK_OUTPUT_R = 16;
   MTYPE_CENTER_AGENT_RUNNING_TASK = 17;
   MTYPE_CENTER_AGENT_RUNNING_TASK_R = 18;
   MTYPE_CENTER_AGENT_RUNNING_OPR = 19;
   MTYPE_CENTER_AGENT_RUNNING_OPR_R = 20;
   MTYPE_UI_AGENT_SUBTASK_OUTPUT = 51;
   MTYPE_UI_AGENT_SUBTASK_OUTPUT_R = 52;
   MTYPE_UI_AGENT_RUNNING_SUBTASK = 53;
   MTYPE_UI_AGENT_RUNNING_SUBTASK_R = 54;
   MTYPE_UI_AGENT_RUNNING_OPR = 55;
   MTYPE_UI_AGENT_RUNNING_OPR_R = 56;
   MTYPE_UI_EXEC_OPR = 57;
   MTYPE_UI_EXEC_OPR_R = 58;
   MTYPE_UI_AGENT_INFO = 59;
   MTYPE_UI_AGENT_INFO_R = 60;
   MTYPE_UI_INVALID_AGENT = 61;
   MTYPE_UI_INVALID_AGENT_R = 62;
   MTYPE_UI_TASK_CMD_INFO = 63;
   MTYPE_UI_TASK_CMD_INFO_R = 64;
   MTYPE_UI_OPR_CMD_INFO = 65;
   MTYPE_UI_OPR_CMD_INFO_R = 66;
   MTYPE_UI_SUBTASK_PROCESS = 67;
   MTYPE_UI_SUBTASK_PROCESS_R = 68;
   MTYPE_UI_EXEC_TASK = 69;
   MTYPE_UI_EXEC_TASK_R = 70;
   MTYPE_UI_WATCH_TASK = 71;
   MTYPE_UI_WATCH_TASK_R = 72;
   MTYPE_UI_CANCEL_WATCH_TASK = 73;
   MTYPE_UI_CANCEL_WATCH_TASK_R = 74;
   MTYPE_INVALID_MTYPE = 101;
}

enum DcmdState {
  SUCCESS = 0;
  FAILED = 1;
}

message KeyValue {
  required  string   key = 1;
  required  string   value= 2;
}

message SubTaskInfo {
  required  string   svr_name=1;
  required  string   task_cmd=2;
  required  string   task_id=3;
  required  string   subtask_id=4;
  required  string   cmd_id=5;
}

message OprInfo {
  required  string     name=1;
  required  string     start_time=2;
  required  int32      running_second=3;
}

message SubTaskProcess {
  required  string     subtask_id = 1;
  optional  string     process = 2;
}

enum AgentState {
  AGENT_UN_CONNECTED=0;
  AGENT_UN_AUTH=1;
  AGENT_UN_REPORTED=2;
  AGENT_CONNECTED=3;
}

enum TaskState {
   TASK_INIT = 0;
   TASK_DOING = 1;
   TASK_PAUSED = 2;
   TASK_FAILED = 3;
   TASK_FREEZED = 4;
   TASK_FINISHED = 5;
   TASK_FINISHED_WITH_FAILED = 6;
}


enum SubTaskState{
   SUBTASK_INIT = 0;
   SUBTASK_DOING = 1;
   SUBTASK_FINISHED = 2;
   SUBTASK_FAILED = 3;
}

enum CommandState {
   COMMAND_DOING = 0;
   COMMAND_SUCCESS = 1;
   COMMAND_FAILED = 2;
}

message TaskInfo {
  required  string      task_id=1;
  required  TaskState   task_state=2;
  required  int32       order = 3;
  optional  string      parent_task_id = 4;
  optional  string      err=5;
  optional  int32       success_subtask=6;
  optional  int32       failed_subtask=7;
  optional  int32       doing_subtask=8;
  optional  int32       undo_subtask=9;
  optional  int32       ignore_doing_subtask=10;
  optional  int32       ignore_failed_subtask=11;
}

message AgentInfo {
  required string     ip=1;
  required AgentState state=2;
  optional string     version=3;
  optional string     connected_ip=4;
  optional string     repored_ip=5;
}

message AgentReport {
  required string      version = 1;
  repeated string      agent_ips = 2;
}

message AgentReportReply {
  required DcmdState   state = 1; 
  optional string      err = 2; 
  optional int32       heatbeat=3;
  optional int32       package_size=4;
  optional int32       opr_queue_threshold=5;
  optional int32       opr_overflow_threshold=6;
}

message AgentMasterNoticeReply {
  repeated string  cmd = 1;
  repeated SubTaskProcess subtask_process = 2;
}

message AgentTaskCmd {
required  string   cmd=1;
required  string   task_cmd=2;
required  bool     ctrl=3;
optional  string   task_id=4;
optional  string   subtask_id=5;
optional  string   ip=6;
optional  string   svr_name=7;
optional  string   svr_pool=8;
optional  string   svr_ver=9;
optional  string   svr_repo=10;
optional  string   svr_user=11;
optional  string   svr_env_ver=12;
optional  bool     update_env=13;
optional  bool     update_ver=14;
optional  bool     output_process=15;
optional  string   script=16;
repeated  KeyValue task_arg=17;
}

message AgentTaskCmdReply {
  required  string  cmd = 1;
}

message AgentSubTaskProcess {
  required  string  task_id = 1; 
  required  string  subtask_id = 2;
  required  string  process=3;
}

message AgentTaskResult {
  required  string  cmd = 1;
  required  string  task_id = 2;
  required  string  subtask_id = 3;
  required  bool    success = 4;
  optional  string  err= 5;
  optional  string  process=6;
}

message AgentTaskResultReply {
  required  string  cmd = 1;
}

message AgentOprCmd {
  required  string   opr_id = 1; 
  required  string   name = 2;
  required  int32    priority=3;
  required  string   run_user = 4;
  required  int32    timeout= 5;
  required  string   script = 6;
  repeated  KeyValue args= 7;
}

message AgentOprCmdReply {
  required  DcmdState  state = 1;
  required  string     result = 2;
  required  string     err= 3; 
  optional  string     ip=4;
}

message AgentTaskOutput {
  required  string  subtask_id = 1;
  required  int32   offset= 2;
  optional  string  ip=3;
}

message AgentTaskOutputReply {
  required  DcmdState   state = 1;
  required  string      result= 2;
  required  int32       offset=3;
  optional  string      err=4;
}

message AgentRunningTask {
  optional  string  ip=1;
  optional  string  svr_name=2;
}

message AgentRunningTaskReply {
  required  DcmdState   state=1;
  repeated  SubTaskInfo result=2;
  optional  string      err=3;
}

message AgentRunningOpr {
  optional  string  ip=1; 
}

message AgentRunningOprReply {
  required  DcmdState state=1; 
  repeated  OprInfo  result=2; 
  optional  string  err=3;
}

message InvalidMsg {
  required  int32  msg_type=1;
}

message UiTaskOutput {
  required  int32     client_msg_id=1;
  required  string    subtask_id=2;
  required  string    ip = 3; 
  required  int32     offset=4; 
  required  string    user=5;
  required  string    passwd=6;
}

message UiTaskOutputReply {
  required  int32       client_msg_id=1;
  required  DcmdState   state = 2;
  required  string      result= 3;
  required  int32       offset=4;
  optional  string      err=5;
}

message UiAgentRunningTask {
  required  int32     client_msg_id=1;
  optional  string    ip=2;
  optional  string    svr_name=3;
  required  string    user=4;
  required  string    passwd=5;
}

message UiAgentRunningTaskReply {
  required  int32       client_msg_id=1;
  required  DcmdState   state=2;
  repeated  SubTaskInfo result=3;
  optional  string      err=4;
}

message UiAgentRunningOpr {
  required  int32     client_msg_id=1;
  optional  string    ip=2;
  required  string    user=3;
  required  string    passwd=4;
}

message UiAgentRunningOprReply {
  required  int32     client_msg_id=1;
  required  DcmdState state=2;
  repeated  OprInfo   result=3;
  optional  string    err=4;
}

message UiExecOprCmd {
  required  int32     client_msg_id=1;
  optional  string   opr_id=2;
  repeated  KeyValue args=3;
  required  string   user=4;
  required  string   passwd=5;
}

message UiExecOprCmdReply{
  required  int32            client_msg_id=1;
  required  DcmdState        state=2;
  repeated  AgentOprCmdReply result=3;
  optional  string           err=4;
}

message UiAgentInfo {
  required  int32     client_msg_id=1;
  repeated  string    ips=2;
  required  bool      version=3;
  required  string    user=4;
  required  string    passwd=5;
}

message UiAgentInfoReply{
  required  int32      client_msg_id=1;
  required  DcmdState  state=2;
  repeated  AgentInfo  agentinfo=3;
  optional  string     err=4;
}

message UiInvalidAgentInfo {
  required  int32   client_msg_id=1;
  required  string  user=2;
  required  string  passwd=3;
}

message UiInvalidAgentInfoReply{
  required  int32      client_msg_id=1;
  required  DcmdState  state=2;
  required  AgentInfo  agentinfo=3;
  optional  string     err=4;
}

message UiTaskScriptInfo {
  required  int32   client_msg_id=1;
  required  string  task_cmd=2;
  required  string  user=3;
  required  string  passwd=4;
}

message UiTaskScriptInfoReply{
  required  int32     client_msg_id=1;
  required  DcmdState state=2;
  optional  string    script=3;
  optional  string    err=4;
  optional  string    md5=5;
}

message UiOprScriptInfo {
  required  int32   client_msg_id=1;
  required  string  opr_file=2;
  required  string  user=3;
  required  string  passwd=4;
}

message UiOprScriptInfoReply{
  required  int32     client_msg_id=1;
  required  DcmdState state=2;
  optional  string    script=3;
  optional  string    err=4;
  optional  string    md5=5;
}

message UiAgentTaskProcess {
  required  int32   client_msg_id=1;
  repeated  string  subtask_id =2;
  required  string  user=3;
  required  string  passwd=4;
}

message UiAgentTaskProcessReply{
  required  int32     client_msg_id=1;
  required  DcmdState state=2;
  repeated SubTaskProcess process = 3;
  optional  string    err=4;
}

enum  CmdType {
   CMD_UNKNOWN = 0;
   CMD_START_TASK = 1;
   CMD_PAUSE_TASK = 2;
   CMD_FINISH_TASK = 3;
   CMD_CANCEL_SUBTASK=4;
   CMD_CANCEL_SVR_SUBTASK=5;
   CMD_REDO_TASK = 6;
   CMD_REDO_SVR_POOL = 7;
   CMD_REDO_SUBTASK = 8;
   CMD_REDO_FAILED_SUBTASK=9;
   CMD_REDO_FAILED_SVR_POOL_SUBTASK=10;
   CMD_IGNORE_SUBTASK=11;
   CMD_FREEZE_TASK=12;
   CMD_UNFREEZE_TASK=13;
   CMD_UPDATE_TASK=14;
}
message UiTaskCmd {
  required  int32   client_msg_id=1;
  required  string  task_id =2;
  optional  string  subtask_id=3;
  optional  string  ip=4;
  optional  string  svr_pool=5;
  required  CmdType cmd_type = 6;
  required  string  user=7;
  required  string  passwd=8;
}

message UiTaskCmdReply{
  required  int32     client_msg_id=1;
  required  DcmdState state=2;
  optional  string    cmd_id=3;
  optional  string    err=4;
}

message UiTaskWatch {
  required  int32   client_msg_id=1;
  required  string  task_id =2;
  required  bool    last_state=3;
  required  string  user=4;
  required  string  passwd=5;
}

message UiTaskWatchReply{
  required  int32       client_msg_id=1;
  required  DcmdState   watch_state=2;
  optional  string      err=3;
  required  TaskInfo    task_info=4;
  repeated  TaskInfo    child_tasks=5;
}

message UiTaskCancelWatch {
  required  int32   client_msg_id=1;
  required  string  task_id =2;
  required  string  user=3;
  required  string  passwd=4;
}

message UiTaskCancelatchReply{
  required  int32       client_msg_id=1;
  required  DcmdState   state=2;
  optional  string      err=3;
}
